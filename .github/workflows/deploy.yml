name: CI/CD Auto Deploy Vehicle Wash

on:
  push:
    branches: [ master ]

jobs:
  # =========================================
  # TUGAS 1: DEPLOY KE LAPTOP FATHI
  # =========================================
  deploy-fathi:
    runs-on: [my-laptop]  # Label laptop Anda
    steps:
      - name: Set project path
        run: |
          # Tanda ~ artinya folder home user aktif (otomatis menyesuaikan)
          PROJECT_PATH=~/web_vehiclewash
          echo "PROJECT_PATH=$PROJECT_PATH" >> $GITHUB_ENV
      
      - name: Pull latest changes
        working-directory: ${{ env.PROJECT_PATH }}
        run: |
          git fetch origin master
          git reset --hard origin/master

      - name: Restart Docker
        working-directory: ${{ env.PROJECT_PATH }}
        run: |
          docker compose down || true
          docker compose up -d --build

  # =========================================
  # TUGAS 2: DEPLOY KE LAPTOP NASHWAN
  # =========================================
  deploy-nashwan:
    # Pastikan teman Anda mendaftarkan runnernya dengan label ini:
    runs-on: [laptop-Nashwan] 
    
    steps:
      - name: Set project path
        run: |
          # Pastikan teman Anda juga menaruh folder project di home (~)
          # Folder project dia harus bernama 'web_vehiclewash' juga
          PROJECT_PATH=~/web_vehiclewash
          echo "PROJECT_PATH=$PROJECT_PATH" >> $GITHUB_ENV

      - name: Pull latest changes
        working-directory: ${{ env.PROJECT_PATH }}
        run: |
          git fetch origin master
          git reset --hard origin/master

      - name: Restart Docker
        working-directory: ${{ env.PROJECT_PATH }}
        run: |
          docker compose down || true
          docker compose up -d --build
